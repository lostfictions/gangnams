<!doctype html>
<html lang="en" class="fancy">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gang Nams</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="helper">
    <a class="btn btn-sm" id="plain" href="#">Toggle Plain</a>
    <a class="btn btn-sm" id="undo" href="#">Undo</a>
    <a class="btn btn-lg" id="another" href="#">Another!</a>
  </div>
  <div id="wrapper">
    <h1 class="victory">
      <span class="xs"></span>
      <span class="sm"></span>
      <span class="lg"></span>
    </h1>
  </div>
  <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="0" height="0">
    <defs>
      <filter id="bloor" x="0" y="0">
        <feGaussianBlur in="SourceGraphic" stdDeviation="13" result="blur"/>
        <feBlend in2="blur" in="SourceGraphic" mode="screen"/>
      </filter>
    </defs>
  </svg>
</body>
<script src="modernizr-custom.js"></script>
<script src="Please.js"></script>
<script src="bundle.js"></script>
<script>
  var s = document.createElement("style");
  document.head.appendChild(s);
  var gradientStyles = s.sheet;
  gradientStyles.insertRule('dummy { }', 0);

  //Undo history
  var hist = [];

  //Elements for text replacement
  var xs = document.querySelector('.victory .xs');
  var sm = document.querySelector('.victory .sm');
  var lg = document.querySelector('.victory .lg');

  var gName = [];
  var col = '';

  function newName() {
    hist.push({ name: gName, col: col })

    gName = gangName();

    //Use the bigger font size if words are missing
    if(gName[2].length === 0) {
      gName[2] = gName[1];
      gName[1] = gName[0];
      gName[0] = '';
    }
    if(gName[1].length === 0) {
      gName[1] = gName[0];
      gName[0] = '';
    }

    //If the descriptor is long, make sure it wraps
    sm.style.whiteSpace = (gName[1].split(' ').length > 2 && gName[1].length > 14) || (gName[1].length > 24) ? 'normal' : 'nowrap'

    //Set text
    xs.innerHTML = gName[0];
    sm.innerHTML = gName[1];
    lg.innerHTML = gName[2];

    //Set new colour
    col = Please.make_color({saturation: 1});
    setColor(col);
  }

  function undo() {
    if(hist.length <= 1) {
      return;
    }

    var h = hist.pop();
    gName = h.name;

    sm.style.whiteSpace = (gName[1].split(' ').length > 2 && gName[1].length > 14) || (gName[1].length > 24) ? 'normal' : 'nowrap'

    xs.innerHTML = gName[0];
    sm.innerHTML = gName[1];
    lg.innerHTML = gName[2];

    col = h.col;
    setColor(col);
  }

  function setColor(color) {
    gradientStyles.deleteRule(0);
    gradientStyles.insertRule('.fancy.cssgradients .victory::before { background: linear-gradient(' + color + ' 40%,  #F9F9F7 80%); }', 0);
  }

  var b = document.querySelector('#another');
  b.onclick = function(e) { e.preventDefault(); newName(); };

  var u = document.querySelector('#undo');
  u.onclick = function(e) { e.preventDefault(); undo(); };

  var p = document.querySelector('#plain');
  var htmlEl = document.querySelector('html').classList;
  p.onclick = function(e) { e.preventDefault(); htmlEl.toggle('fancy'); };

  newName();
</script>

</html>
